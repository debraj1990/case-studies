pipeline {
  //tools {
    //nodejs "node"
  //}
  //node {       
   //def workspace = pwd() 
  //}
  agent {
    docker {
      image 'node:6-alpine'
      args '-p 3000:3000'
    }
  }
  environment {
    CI = 'true' 
  }

  

  stages {
    
    stage('Checkout') {
      steps {
        git 'https://github.com/XT-training/case-studies.git'
      }
    }

    stage('Client dependencies install') {
      steps {  
        sh 'cd /var/jenkins_home/workspace/Capstone@script/capstone/client && npm install'    
      }
    }

    stage('Client run') {
      steps {
        sh 'cd /var/jenkins_home/workspace/Capstone@script/capstone/client && npm run build'    
      }
    }
    
    stage('server dependencies install') {
      steps {  
        sh 'cd /var/jenkins_home/workspace/Capstone@script/capstone/api-server && npm install'    
        //dir('${workspace}@script/capstone/api-server') {
          //sh 'npm install'
        //}
      }
    }

    stage('server run') {
      steps {
        //dir('${workspace}@script/capstone/api-server') {
          //sh 'npm start'
        //}
        sh 'cd /var/jenkins_home/workspace/Capstone@script/capstone/api-server && npm run build'    
      }
    }
  }
}
    